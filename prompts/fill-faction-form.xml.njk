<template>
<role>Takes a partially-complete faction form in XML and fills in empty fields.</role>

<systemPrompt>
You are a specialized RPG worldbuilding assistant. You receive one partially filled faction record and a list of existing factions.

Your task:
- Fill only missing/empty fields.
- Preserve any non-empty values exactly as provided.
- Keep the result coherent with the existing factions and setting.
- Never name a faction "None".
- Do not duplicate an existing faction name.
- Keep relation statuses limited to: allied, neutral, hostile, rival.
- Ensure each relation includes concise notes.
- Ensure reputation tiers are sensible and ordered by threshold.
- Use the exact nested XML schema shown below for all generated entries.
- Do not use attribute-only, shorthand, or compact variants for `asset`, `relation`, or `tier` nodes.

Return only XML for a single &lt;faction&gt; entry, with no commentary.
</systemPrompt>

<generationPrompt>
Setting context:
{{ settingDescription }}

Existing factions (avoid duplicate names; use these names in relations):
<existingFactions>
{% for faction in existingFactions %}
  <faction>
    <id>{{ faction.id }}</id>
    <name>{{ faction.name }}</name>
    <shortDescription>{{ faction.shortDescription }}</shortDescription>
  </faction>
{% endfor %}
</existingFactions>

Partially completed faction to finish:
<faction>
  <name>{{ faction.name }}</name>
  <homeRegionName>{{ faction.homeRegionName }}</homeRegionName>
  <shortDescription>{{ faction.shortDescription }}</shortDescription>
  <description>{{ faction.description }}</description>
  <tags>
{% for tag in faction.tags %}
    <tag>{{ tag }}</tag>
{% endfor %}
  </tags>
  <goals>
{% for goal in faction.goals %}
    <goal>{{ goal }}</goal>
{% endfor %}
  </goals>
  <assets>
{% for asset in faction.assets %}
    <asset>
      <name>{{ asset.name }}</name>
      <type>{{ asset.type }}</type>
      <description>{{ asset.description }}</description>
    </asset>
{% endfor %}
  </assets>
  <relations>
{% for relation in faction.relationEntries %}
    <relation>
      <factionName>{{ relation.factionName }}</factionName>
      <status>{{ relation.status }}</status>
      <notes>{{ relation.notes }}</notes>
    </relation>
{% endfor %}
  </relations>
  <reputationTiers>
{% for tier in faction.reputationTiers %}
    <tier>
      <threshold>{{ tier.threshold }}</threshold>
      <label>{{ tier.label }}</label>
      <perks>
{% for perk in tier.perks %}
        <perk>{{ perk }}</perk>
{% endfor %}
      </perks>
      <penalties>
{% for penalty in tier.penalties %}
        <penalty>{{ penalty }}</penalty>
{% endfor %}
      </penalties>
    </tier>
{% endfor %}
  </reputationTiers>
</faction>

Fill any empty/missing fields while preserving all non-empty fields exactly.
If relations are empty, add one relation per existing faction name.
If reputation tiers are empty, provide at least 3 ordered tiers.
Use this exact output schema:
&lt;faction&gt;
  &lt;name&gt;...&lt;/name&gt;
  &lt;homeRegionName&gt;...&lt;/homeRegionName&gt;
  &lt;shortDescription&gt;...&lt;/shortDescription&gt;
  &lt;description&gt;...&lt;/description&gt;
  &lt;tags&gt;
    &lt;tag&gt;...&lt;/tag&gt;
  &lt;/tags&gt;
  &lt;goals&gt;
    &lt;goal&gt;...&lt;/goal&gt;
  &lt;/goals&gt;
  &lt;assets&gt;
    &lt;asset&gt;
      &lt;name&gt;...&lt;/name&gt;
      &lt;type&gt;...&lt;/type&gt;
      &lt;description&gt;...&lt;/description&gt;
    &lt;/asset&gt;
  &lt;/assets&gt;
  &lt;relations&gt;
    &lt;relation&gt;
      &lt;factionName&gt;...&lt;/factionName&gt;
      &lt;status&gt;allied|neutral|hostile|rival&lt;/status&gt;
      &lt;notes&gt;...&lt;/notes&gt;
    &lt;/relation&gt;
  &lt;/relations&gt;
  &lt;reputationTiers&gt;
    &lt;tier&gt;
      &lt;threshold&gt;...&lt;/threshold&gt;
      &lt;label&gt;...&lt;/label&gt;
      &lt;perks&gt;
        &lt;perk&gt;...&lt;/perk&gt;
      &lt;/perks&gt;
      &lt;penalties&gt;
        &lt;penalty&gt;...&lt;/penalty&gt;
      &lt;/penalties&gt;
    &lt;/tier&gt;
  &lt;/reputationTiers&gt;
&lt;/faction&gt;
Return only the completed XML faction node.
</generationPrompt>
</template>
