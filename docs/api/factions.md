# Factions API

## GET /api/factions
List all factions and current player standings.

Response:
- 200: `{ success: true, factions: Faction[], playerStandings: Record<factionId, number>, playerId }`
- 500: `{ success: false, error }`

## POST /api/factions
Create a new faction.

Request:
- Body: `{ name: string, shortDescription?: string|null, description?: string|null, tags?: string[]|string, goals?: string[]|string, homeRegionName?: string, assets?: Array<{ name: string, type?: string, description?: string }>, relations?: Record<factionId, { status: 'allied'|'neutral'|'hostile'|'rival', notes: string }>, reputationTiers?: Array<{ threshold: number, label?: string, perks?: string[]|string, penalties?: string[]|string }> }`

Response:
- 201: `{ success: true, faction: Faction }`
- 400: `{ success: false, error }`
- 500: `{ success: false, error }`

Notes:
- Faction name `"None"` is reserved and cannot be created.

## POST /api/factions/fill-missing
Auto-fill missing faction fields using AI while preserving provided values.

Request:
- Body: `{ faction: PartialFaction }`
  - Supported faction fields: `name`, `homeRegionName`, `shortDescription`, `description`, `tags`, `goals`, `assets`, `relations`, `reputationTiers`.
  - `relations` may be an id-keyed relation object (same shape as `/api/factions`).

Behavior:
- If no relevant fields are missing, the endpoint returns the normalized input payload unchanged.
- If any relevant fields are missing, it renders `prompts/fill-faction-form.xml.njk`, calls the LLM, merges only missing values, and returns the completed faction payload.
- Relation entries generated by name are resolved to existing faction ids server-side.

Response:
- 200: `{ success: true, faction: FactionCreatePayload, raw: string|null }`
- 400: `{ success: false, error }` for malformed request body.
- 500: `{ success: false, error }` for prompt/render/LLM/parse failures.

## PUT /api/factions/:id
Update a faction.

Request:
- Path: `id` (faction id)
- Body supports: `name`, `shortDescription`, `description`, `tags`, `goals`, `homeRegionName`, `assets`, `relations`, `reputationTiers`

Response:
- 200: `{ success: true, faction: Faction }`
- 400/404/500 with `{ success: false, error }`

Notes:
- Faction name `"None"` is reserved and cannot be set.

## DELETE /api/factions/:id
Delete a faction, remove relations pointing to it, and clear affiliations/standings.

Response:
- 200: `{ success: true, removed: Faction }`
- 400/404/500 with `{ success: false, error }`

## PUT /api/player/factions/:id/standing
Set or clear the current player's standing with a faction.

Request:
- Path: `id` (faction id)
- Body: `{ value: number | null }` (`null` removes the standing entry)

Response:
- 200: `{ success: true, factionId, standings: Record<factionId, number> }`
- 400/404/500 with `{ success: false, error }`
